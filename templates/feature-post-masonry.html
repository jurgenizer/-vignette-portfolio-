{% extends "layout.html" %}
{% block title %}{{ this.title }} | Editorial features, such as this one, are sold exclusively on a country-to-country
basis{% endblock %}
{% block body %}
<link rel="stylesheet" href="{{ '/static/masonry.css'|url }}">
<!-- Thank you https://imagesloaded.desandro.com/-->
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>

<h1 class="title has-text-primary">{{ this.title }}</h1>

<div class="container">
  {{ this.body }}
  {% set documents = this.attachments.documents.all() %}
  {% if documents %}
  {% for document in documents %}
  <a href="{{document._id}}" class="button is-link" target="_blank"> Download {{ document._id }}</a>
  {% endfor %}
  {% endif %}

  {% set images = this.attachments.images.all() %}
  {% if images %}
<!--   <div class="wrapper"> -->
    <div class="masonry">
      {% for image in images %}
      <div class="masonry-brick">
        <img src="{{ image|url }}" alt="Image of {{ this.title }}" class="masonry-img">
        <p class="top-left">{{ image.record_label }}</p>
      </div>
      {% endfor %}
    </div>
<!--   </div> -->
  {% endif %}

</div>

<section class="section">
  <div class="container">
    {% set siblings = this.get_siblings() %}
    {% set older = siblings.next_page %}
    {% set newer = siblings.prev_page %}

    <nav class="pagination is-small" role="navigation" aria-label="pagination">
      {% if older %}
      <a class="pagination-previous" href="{{ older|url }}">Previous: {{ older.title }}</a>
      {% endif %}
      {% if newer %}
      <a class="pagination-next" href="{{ newer|url }}">Next: {{ newer.title }}</a>
      {% endif %}
    </nav>
  </div>
</section>

<script>
/**
 * Preload and reform the masonry
 *
 * Add some preloader text to the masonry grid and rebuild it on every resize
 * and load event after making sure all the images in the grid are loaded
 * completely.
 */

 function masonry(grid, gridCell, gridGutter, dGridCol, tGridCol, mGridCol) {
  var g = document.querySelector(grid),
      gc = document.querySelectorAll(gridCell),
      gcLength = gc.length,
      gHeight = 0,
      i;
  
  for(i=0; i<gcLength; ++i) {
    gHeight+=gc[i].offsetHeight+parseInt(gridGutter);
  }
  
  if(window.screen.width >= 1024)
    g.style.height = gHeight/dGridCol + gHeight/(gcLength+1) + "px";
  else if(window.screen.width < 1024 && window.screen.width >= 768)
    g.style.height = gHeight/tGridCol + gHeight/(gcLength+1) + "px";
  else
    g.style.height = gHeight/mGridCol + gHeight/(gcLength+1) + "px";
}

// Grab the masonry grid
var masonryElem = document.querySelector('.masonry');

// Insert preloader text dynamically
masonryElem.insertAdjacentHTML("afterend", "<div class='jurgen-preloader'></div>")

// Grab the masonry preloader
var masonryPreloader = document.querySelector('.jurgen-preloader');

// Fire the magic on every load and resize event
['resize', 'load'].forEach(function(event) {
  // Hide the masonry until it loads
  masonryElem.style.display='none';

  // Follow the below steps on every load and resize event
  window.addEventListener(event, function() {

    // Check if all the images finished loading
    imagesLoaded( document.querySelector('.masonry'), function() {

      // Show the masonry, as it is loaded now
      masonryElem.style.display='flex';

      // Hide the preloader, as it is not needed anymore
      masonryPreloader.style.display='none';

      /*
       * A maonsry grid with 8px gutter, with 3 columns on desktop,
       * 2 on tablet, and 1 column on mobile devices.
       */
      masonry('.masonry', '.masonry-brick', 8, 3, 2, 1);

      // Done!
      console.log('Flexbox Masonry Loaded');
    });
  }, false);
});
</script>

{% endblock %}